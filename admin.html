<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª –ö–∞—Ä–∞–∫–æ–ª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .admin-header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .admin-header h1 {
            font-size: 2.5rem;
            color: #00d4ff;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .admin-header p {
            color: #b0c4de;
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            padding: 5px;
            gap: 5px;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            color: #b0c4de;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .tab-content {
            display: none;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #00d4ff;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input, select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #ff3742);
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ffa502, #ff6348);
            box-shadow: 0 4px 15px rgba(255, 165, 2, 0.3);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        .admin-table th, .admin-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        }

        .admin-table th {
            background: rgba(0, 0, 0, 0.8);
            color: #00d4ff;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-table td {
            color: #e8e8e8;
        }

      .status-badge {
           padding: 6px 12px;
           border-radius: 15px;
           font-size: 0.8rem;
           font-weight: 600;
           text-transform: uppercase;
           border: 1px solid;
       }

       .status-waiting { 
           background: rgba(255, 215, 0, 0.2); 
           color: #ffd700; 
           border-color: #ffd700; 
       }

       .status-boarding { 
           background: rgba(50, 205, 50, 0.2); 
           color: #32cd32; 
           border-color: #32cd32; 
       }

       .status-delayed { 
           background: rgba(255, 69, 0, 0.2); 
           color: #ff4500; 
           border-color: #ff4500; 
       }

       .status-departed { 
           background: rgba(112, 128, 144, 0.2); 
           color: #708090; 
           border-color: #708090; 
       }

       .stats-grid {
           display: grid;
           grid-template-columns: repeat(4, 1fr);
           gap: 20px;
           margin-bottom: 30px;
       }

       .stat-card {
           background: rgba(0, 0, 0, 0.6);
           padding: 25px;
           border-radius: 12px;
           text-align: center;
           border: 1px solid rgba(0, 212, 255, 0.2);
           transition: all 0.3s ease;
       }

       .stat-card:hover {
           transform: translateY(-5px);
           box-shadow: 0 10px 25px rgba(0, 212, 255, 0.2);
       }

       .stat-value {
           font-size: 2.5rem;
           font-weight: 300;
           color: #00d4ff;
           margin-bottom: 8px;
           text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
       }

       .stat-label {
           color: #b0c4de;
           font-size: 0.9rem;
           text-transform: uppercase;
           letter-spacing: 1px;
       }

       .section-title {
           color: #00d4ff;
           font-size: 1.3rem;
           font-weight: 600;
           margin-bottom: 20px;
           padding-bottom: 10px;
           border-bottom: 2px solid rgba(0, 212, 255, 0.3);
       }

       .report-filters {
           display: flex;
           gap: 15px;
           align-items: end;
           margin-bottom: 25px;
       }

       .report-content {
           background: rgba(0, 0, 0, 0.4);
           padding: 20px;
           border-radius: 10px;
           margin-top: 20px;
       }

       /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
       @media (max-width: 768px) {
           .form-grid {
               grid-template-columns: 1fr;
           }
           
           .stats-grid {
               grid-template-columns: repeat(2, 1fr);
           }
           
           .tabs {
               flex-direction: column;
           }
       }
   </style>
</head>
<body>
   <div class="admin-header">
       <h1>üöå –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª –ö–∞—Ä–∞–∫–æ–ª</h1>
       <p>–ò–∑–º–µ–Ω–µ–Ω–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ</p>
   </div>

   <div class="tabs">
       <button class="tab active" onclick="showTab('manage')">–ë–∞—à–∫–∞—Ä—É—É ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
       <button class="tab" onclick="showTab('reports')">–û—Ç—á–µ—Ç—Ç–æ—Ä ‚Ä¢ –û—Ç—á–µ—Ç—ã</button>
       <button class="tab" onclick="showTab('history')">–¢–∞—Ä—ã—Ö ‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è</button>
       <button class="tab" onclick="showTab('settings')">–ñ”©–Ω–¥”©”©–ª”©—Ä ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
   </div>

   <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
   <div class="tab-content active" id="manage-tab">
       <div class="section-title">–ñ–∞“£—ã –∞–≤—Ç–æ–±—É—Å –∫–æ—à—É—É ‚Ä¢ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞–≤—Ç–æ–±—É—Å</div>
       
       <div class="form-grid">
           <div class="form-group">
               <label>–ë–∞–≥—ã—Ç ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç</label>
               <input type="text" id="route" placeholder="–ë–∏—à–∫–µ–∫">
           </div>
           <div class="form-group">
               <label>–£–±–∞–∫—ã—Ç ‚Ä¢ –í—Ä–µ–º—è</label>
               <input type="time" id="time">
           </div>
           <div class="form-group">
               <label>–ê–±–∞–ª—ã ‚Ä¢ –°—Ç–∞—Ç—É—Å</label>
               <select id="status">
                   <option value="waiting">–ö“Ø—Ç“Ø“Ø–¥”© ‚Ä¢ –û–∂–∏–¥–∞–Ω–∏–µ</option>
                   <option value="boarding">–û—Ç—É—Ä–≥—É–∑—É—É ‚Ä¢ –ü–æ—Å–∞–¥–∫–∞</option>
                   <option value="delayed">–ö–µ—á–∏–≥“Ø“Ø ‚Ä¢ –û–ø–∞–∑–¥—ã–≤–∞–µ—Ç</option>
                   <option value="departed">–ö–µ—Ç—Ç–∏ ‚Ä¢ –£–µ—Ö–∞–ª</option>
               </select>
           </div>
           <div class="form-group">
               <label>–û—Ä—É–Ω–¥–∞—Ä —Å–∞–Ω—ã ‚Ä¢ –ú–µ—Å—Ç–∞</label>
               <input type="number" id="seats" placeholder="45" min="20" max="80">
           </div>
           <div class="form-group">
               <label>–¢–∞—à—É—É—á—É ‚Ä¢ –ü–µ—Ä–µ–≤–æ–∑—á–∏–∫</label>
               <input type="text" id="carrier" placeholder="–ö–∞—Ä–∞–∫–æ–ª –¢—Ä–∞–Ω—Å">
           </div>
           <div class="form-group">
               <label>–ê–π–¥–æ–æ—á—É ‚Ä¢ –í–æ–¥–∏—Ç–µ–ª—å</label>
               <input type="text" id="driver" placeholder="–≠–º–∏–ª–±–µ–∫ —É.">
           </div>
       </div>

       <button class="btn" onclick="addBus()">–ö–æ—à—É—É ‚Ä¢ –î–æ–±–∞–≤–∏—Ç—å</button>
       <button class="btn btn-secondary" onclick="addRandomBus()">–ö–æ–∫—É—Å—Ç—É–∫ ‚Ä¢ –°–ª—É—á–∞–π–Ω—ã–π</button>
       <button class="btn btn-danger" onclick="clearAll()">–ë–∞–∞—Ä—ã–Ω —Ç–∞–∑–∞–ª–æ–æ ‚Ä¢ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>

       <div class="section-title" style="margin-top: 40px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Ä¢ Statistics</div>
       <div class="stats-grid">
           <div class="stat-card">
               <div class="stat-value" id="total-count">0</div>
               <div class="stat-label">–ë–∞—Ä–¥—ã–≥—ã ‚Ä¢ –í—Å–µ–≥–æ</div>
           </div>
           <div class="stat-card">
               <div class="stat-value" id="waiting-count">0</div>
               <div class="stat-label">–ö“Ø—Ç“Ø“Ø–¥”© ‚Ä¢ –û–∂–∏–¥–∞–Ω–∏–µ</div>
           </div>
           <div class="stat-card">
               <div class="stat-value" id="boarding-count">0</div>
               <div class="stat-label">–û—Ç—É—Ä–≥—É–∑—É—É ‚Ä¢ –ü–æ—Å–∞–¥–∫–∞</div>
           </div>
           <div class="stat-card">
               <div class="stat-value" id="departed-count">0</div>
               <div class="stat-label">–ö–µ—Ç—Ç–∏ ‚Ä¢ –£–µ—Ö–∞–ª–∏</div>
           </div>
       </div>

       <div class="section-title">–£—á—É—Ä–¥–∞–≥—ã –∞–≤—Ç–æ–±—É—Å—Ç–∞—Ä ‚Ä¢ –¢–µ–∫—É—â–∏–µ –∞–≤—Ç–æ–±—É—Å—ã</div>
       <table class="admin-table">
           <thead>
               <tr>
                   <th>–ë–∞–≥—ã—Ç ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç</th>
                   <th>–£–±–∞–∫—ã—Ç ‚Ä¢ –í—Ä–µ–º—è</th>
                   <th>–ê–±–∞–ª—ã ‚Ä¢ –°—Ç–∞—Ç—É—Å</th>
                   <th>–û—Ä—É–Ω–¥–∞—Ä ‚Ä¢ –ú–µ—Å—Ç–∞</th>
                   <th>–ê—Ä–∞–∫–µ—Ç—Ç–µ—Ä ‚Ä¢ –î–µ–π—Å—Ç–≤–∏—è</th>
               </tr>
           </thead>
           <tbody id="admin-table-body"></tbody>
       </table>
   </div>

   <!-- –û—Ç—á–µ—Ç—ã -->
   <div class="tab-content" id="reports-tab">
       <div class="section-title">–ö“Ø–Ω–¥“Ø–∫ –æ—Ç—á–µ—Ç ‚Ä¢ –î–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</div>
       <div class="report-filters">
           <div class="form-group">
               <label>–ö“Ø–Ω —Ç–∞–Ω–¥–æ–æ ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</label>
               <input type="date" id="report-date">
           </div>
           <button class="btn" onclick="generateReport()">–û—Ç—á–µ—Ç —Ç“Ø–∑“Ø“Ø ‚Ä¢ –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç</button>
       </div>
       <div id="report-content" class="report-content" style="display: none;">
           <div class="stats-grid">
               <div class="stat-card">
                   <div class="stat-value" id="report-total">0</div>
                   <div class="stat-label">–ö–æ—à—É–ª–≥–∞–Ω ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–æ</div>
               </div>
               <div class="stat-card">
                   <div class="stat-value" id="report-departed">0</div>
                   <div class="stat-label">–ö–µ—Ç–∫–µ–Ω ‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
               </div>
               <div class="stat-card">
                   <div class="stat-value" id="report-delayed">0</div>
                   <div class="stat-label">–ö–µ—á–∏–≥“Ø“Ø ‚Ä¢ –ó–∞–¥–µ—Ä–∂–∫–∏</div>
               </div>
               <div class="stat-card">
                   <div class="stat-value" id="report-announcements">0</div>
                   <div class="stat-label">–ñ–∞—Ä—ã—è–ª–æ–æ–ª–æ—Ä ‚Ä¢ –û–±—ä—è–≤–ª–µ–Ω–∏—è</div>
               </div>
           </div>
           <table class="admin-table">
               <thead>
                   <tr>
                       <th>–£–±–∞–∫—ã—Ç ‚Ä¢ –í—Ä–µ–º—è</th>
                       <th>–ë–∞–≥—ã—Ç ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç</th>
                       <th>–ê–±–∞–ª—ã ‚Ä¢ –°—Ç–∞—Ç—É—Å</th>
                       <th>–û—Ä—É–Ω–¥–∞—Ä ‚Ä¢ –ú–µ—Å—Ç–∞</th>
                   </tr>
               </thead>
               <tbody id="report-table-body"></tbody>
           </table>
       </div>
   </div>

   <!-- –ò—Å—Ç–æ—Ä–∏—è -->
   <div class="tab-content" id="history-tab">
       <div class="section-title">–°–∏—Å—Ç–µ–º–∞–Ω—ã–Ω —Ç–∞—Ä—ã—Ö—ã ‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è —Å–∏—Å—Ç–µ–º—ã</div>
       <div class="report-filters">
           <div class="form-group">
               <label>–ö“Ø–Ω —Ç–∞–Ω–¥–æ–æ ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</label>
               <input type="date" id="history-date">
           </div>
           <button class="btn" onclick="showHistory()">–¢–∞—Ä—ã—Ö—Ç—ã –∫”©—Ä—Å”©—Ç“Ø“Ø ‚Ä¢ –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
       </div>
       <div id="history-content" class="report-content" style="display: none;">
           <table class="admin-table">
               <thead>
                   <tr>
                       <th>–£–±–∞–∫—ã—Ç ‚Ä¢ –í—Ä–µ–º—è</th>
                       <th>–ê—Ä–∞–∫–µ—Ç ‚Ä¢ –î–µ–π—Å—Ç–≤–∏–µ</th>
                       <th>–ë–∞–≥—ã—Ç ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç</th>
                       <th>–î–µ—Ç–∞–ª–∏ ‚Ä¢ –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</th>
                   </tr>
               </thead>
               <tbody id="history-table-body"></tbody>
           </table>
       </div>
   </div>

   <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
   <div class="tab-content" id="settings-tab">
       <div class="section-title">–°–∏—Å—Ç–µ–º–∞ –∂”©–Ω–¥”©”©–ª”©—Ä“Ø ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</div>
       <div class="form-grid">
           <div class="form-group">
               <label>–ñ–∞“£—ã—Ä—Ç—É—É –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã ‚Ä¢ –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Å–µ–∫)</label>
               <input type="number" id="update-interval" value="3" min="1" max="60">
           </div>
           <div class="form-group">
               <label>–î–æ–±—É—à –∫“Ø—á“Ø ‚Ä¢ –ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–∞</label>
               <input type="range" id="volume" min="0" max="1" step="0.1" value="0.8">
           </div>
           <div class="form-group">
               <label>–ê–≤—Ç–æ–æ—á—É—Ä—É—É ‚Ä¢ –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ (–º–∏–Ω)</label>
               <input type="number" id="auto-remove" value="1" min="1" max="60">
           </div>
       </div>
       <button class="btn" onclick="saveSettings()">–°–∞–∫—Ç–æ–æ ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
       <button class="btn btn-secondary" onclick="testSound()">–î–æ–±—É—à —Ç–µ—Å—Ç–∏ ‚Ä¢ –¢–µ—Å—Ç –∑–≤—É–∫–∞</button>
       <button class="btn btn-danger" onclick="resetSystem()">–°–∏—Å—Ç–µ–º–∞–Ω—ã –±–∞—à—Ç–∞–ø–∫—ã –∞–±–∞–ª–≥–∞ –∫–µ–ª—Ç–∏—Ä“Ø“Ø ‚Ä¢ –°–±—Ä–æ—Å</button>
   </div>

   <script>
       let buses = [];
       let busCounter = 1;
       let database = {
           buses: [],
           deleted: [],
           history: []
       };

       // –ò–°–ü–†–ê–í–õ–ï–ù–û: –í—Ä–µ–º—è –≤—Å–µ–≥–¥–∞ –Ω–∞ —á–∞—Å –ø–æ–∑–∂–µ —Ç–µ–∫—É—â–µ–≥–æ
       function setDefaultTime() {
           const now = new Date();
           const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);
           document.getElementById('time').value = oneHourLater.toTimeString().slice(0, 5);
       }

       function loadData() {
           try {
               const saved = localStorage.getItem('karakol-bus-station-display');
               if (saved) {
                   const data = JSON.parse(saved);
                   buses = data.buses || [];
                   busCounter = data.busCounter || 1;
               }
               
               const savedDb = localStorage.getItem('karakol-bus-station-db');
               if (savedDb) {
                   database = JSON.parse(savedDb);
               }
               
               updateTable();
               updateStats();
           } catch (error) {
               console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
           }
       }

       // –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
       function saveData() {
           try {
               const displayData = {
                   buses: buses,
                   busCounter: busCounter,
                   lastUpdate: new Date().toISOString()
               };
               localStorage.setItem('karakol-bus-station-display', JSON.stringify(displayData));
               localStorage.setItem('karakol-bus-station-db', JSON.stringify(database));
               console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');
           } catch (error) {
               console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', error);
           }
       }

       function addToHistory(action, busData, details = {}) {
           const historyEntry = {
               id: Date.now(),
               timestamp: new Date(),
               action: action,
               bus: { ...busData },
               details: details
           };
           database.history.push(historyEntry);
           saveData();
       }

       function addBus() {
           const route = document.getElementById('route').value.trim();
           const time = document.getElementById('time').value;
           const status = document.getElementById('status').value;
           const seats = parseInt(document.getElementById('seats').value);
           const carrier = document.getElementById('carrier').value.trim();
           const driver = document.getElementById('driver').value.trim();

           if (!route || !time || !seats || !carrier || !driver) {
               alert('–ë–∞—Ä–¥—ã–∫ —Ç–∞–ª–∞–∞–ª–∞—Ä–¥—ã —Ç–æ–ª—Ç—É—Ä—É“£—É–∑! ‚Ä¢ –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
               return;
           }

           if (seats < 20 || seats > 80) {
               alert('–û—Ä—É–Ω–¥–∞—Ä —Å–∞–Ω—ã 20–¥–æ–Ω 80–≥”© —á–µ–π–∏–Ω –±–æ–ª—É—à—É –∫–µ—Ä–µ–∫!');
               return;
           }

           const newBus = {
               id: busCounter++,
               route, time, status, seats, carrier, driver,
               created: new Date(),
               announcements: {
                   fiveMinutes: false,
                   boarding: false,
                   departed: false
               }
           };

           buses.push(newBus);
           addToHistory('manual_add', newBus);
           saveData();
           clearForm();
           updateTable();
           updateStats();
           setDefaultTime(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–≤–∏–º –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è
       }

       function addRandomBus() {
           const routes = ['–ë–∏—à–∫–µ–∫', '–ê–ª–º–∞—Ç—ã', '–û—à', '–ù–∞—Ä—ã–Ω', '–ß–æ–ª–ø–æ–Ω-–ê—Ç–∞', '–ë–∞–ª—ã–∫—á—ã', '–¢–æ–∫–º–æ–∫'];
           const carriers = ['–ö–∞—Ä–∞–∫–æ–ª –¢—Ä–∞–Ω—Å', '–ê–ª–∞-–¢–æ–æ –≠–∫—Å–ø—Ä–µ—Å—Å', '–¢“Ø—à—Ç“Ø–∫ –ñ–æ–ª', '–ö”©–ª –¢—É—Ä'];
           const drivers = ['–≠–º–∏–ª–±–µ–∫ —É.', '–ù—É—Ä–ª–∞–Ω —É.', '–ë–∞–∫—ã—Ç —É.', '–ú–µ–¥–µ—Ç —É.', '–ê–∑–∞–º–∞—Ç —É.'];

           const now = new Date();
           const future = new Date(now.getTime() + Math.random() * 6 * 60 * 60 * 1000);

           const newBus = {
               id: busCounter++,
               route: routes[Math.floor(Math.random() * routes.length)],
               time: future.toTimeString().slice(0, 5),
               status: 'waiting',
               seats: Math.floor(Math.random() * 40) + 30,
               carrier: carriers[Math.floor(Math.random() * carriers.length)],
               driver: drivers[Math.floor(Math.random() * drivers.length)],
               created: new Date(),
               announcements: {
                   fiveMinutes: false,
                   boarding: false,
                   departed: false
               }
           };

           buses.push(newBus);
           addToHistory('random_add', newBus);
           saveData();
           updateTable();
           updateStats();
       }

       // –ò–°–ü–†–ê–í–õ–ï–ù–û: –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
       function changeStatus(busId) {
           const bus = buses.find(b => b.id === busId);
           if (!bus) return;

           const statuses = ['waiting', 'boarding', 'delayed', 'departed'];
           const currentIndex = statuses.indexOf(bus.status);
           const nextIndex = (currentIndex + 1) % statuses.length;
           
           const oldStatus = bus.status;
           bus.status = statuses[nextIndex];
           
           addToHistory('manual_status_change', bus, { oldStatus, newStatus: bus.status });
           saveData();
           updateTable();
           updateStats();
       }

       function deleteBus(busId) {
           if (confirm('–ë—É–ª –∞–≤—Ç–æ–±—É—Å—Ç—É —á—ã–Ω–∞–ø —ç–ª–µ ”©—á“Ø—Ä”©—Å“Ø–∑–±“Ø? ‚Ä¢ –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∞–≤—Ç–æ–±—É—Å?')) {
               const busIndex = buses.findIndex(b => b.id === busId);
               if (busIndex !== -1) {
                   const bus = buses[busIndex];
                   database.deleted.push({
                       ...bus,
                       deletedAt: new Date(),
                       deletedBy: 'admin'
                   });
                   buses.splice(busIndex, 1);
                   addToHistory('deleted', bus);
                   saveData();
                   updateTable();
                   updateStats();
               }
           }
       }

       function clearAll() {
           if (confirm('–ë–∞–∞—Ä–¥—ã–∫ –∞–≤—Ç–æ–±—É—Å—Ç–∞—Ä–¥—ã ”©—á“Ø—Ä”©—Å“Ø–∑–±“Ø? ‚Ä¢ –£–¥–∞–ª–∏—Ç—å –í–°–ï –∞–≤—Ç–æ–±—É—Å—ã?')) {
               buses.forEach(bus => {
                   database.deleted.push({
                       ...bus,
                       deletedAt: new Date(),
                       deletedBy: 'admin_clear_all'
                   });
                   addToHistory('cleared', bus);
               });
               buses = [];
               saveData();
               updateTable();
               updateStats();
           }
       }

       function updateTable() {
           const tbody = document.getElementById('admin-table-body');
           
           if (buses.length === 0) {
               tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">–ê–≤—Ç–æ–±—É—Å—Ç–∞—Ä –∂–æ–∫ ‚Ä¢ –ù–µ—Ç –∞–≤—Ç–æ–±—É—Å–æ–≤</td></tr>';
               return;
           }

           tbody.innerHTML = buses.map(bus => `
               <tr>
                   <td>${bus.route}</td>
                   <td>${bus.time}</td>
                   <td><span class="status-badge status-${bus.status}">${getStatusText(bus.status)}</span></td>
                   <td>${bus.seats}</td>
                   <td>
                       <button class="btn" onclick="changeStatus(${bus.id})" style="padding: 6px 12px; font-size: 0.8rem;">–°—Ç–∞—Ç—É—Å</button>
                       <button class="btn btn-danger" onclick="deleteBus(${bus.id})" style="padding: 6px 12px; font-size: 0.8rem;">”®—á“Ø—Ä“Ø“Ø</button>
                   </td>
               </tr>
           `).join('');
       }

       function updateStats() {
           document.getElementById('total-count').textContent = buses.length;
           document.getElementById('waiting-count').textContent = buses.filter(b => b.status === 'waiting').length;
           document.getElementById('boarding-count').textContent = buses.filter(b => b.status === 'boarding').length;
           document.getElementById('departed-count').textContent = buses.filter(b => b.status === 'departed').length;
       }

       function getStatusText(status) {
           const texts = {
               'waiting': '–ö“Ø—Ç“Ø“Ø–¥”©',
               'boarding': '–û—Ç—É—Ä–≥—É–∑—É—É',
               'delayed': '–ö–µ—á–∏–≥“Ø“Ø',
               'departed': '–ö–µ—Ç—Ç–∏'
           };
           return texts[status] || status;
       }

       function clearForm() {
           document.getElementById('route').value = '';
           document.getElementById('time').value = '';
           document.getElementById('seats').value = '';
           document.getElementById('carrier').value = '';
           document.getElementById('driver').value = '';
           document.getElementById('status').value = 'waiting';
       }

       function showTab(tabName) {
           document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
           document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
           
           event.target.classList.add('active');
           document.getElementById(tabName + '-tab').classList.add('active');
           
           if (tabName === 'reports') {
               document.getElementById('report-date').value = new Date().toISOString().split('T')[0];
           }
           if (tabName === 'history') {
               document.getElementById('history-date').value = new Date().toISOString().split('T')[0];
           }
       }

       function generateReport() {
           const selectedDate = document.getElementById('report-date').value;
           if (!selectedDate) {
               alert('–ö“Ø–Ω —Ç–∞–Ω–¥–∞“£—ã–∑! ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!');
               return;
           }
           
           const reportDate = new Date(selectedDate);
           const dateStr = reportDate.toDateString();
           const dayHistory = database.history.filter(h => 
               new Date(h.timestamp).toDateString() === dateStr
           );
           
           const uniqueBuses = [];
           const seenBusIds = new Set();
           dayHistory.forEach(h => {
               if ((h.action === 'manual_add' || h.action === 'random_add') && !seenBusIds.has(h.bus.id)) {
                   uniqueBuses.push(h);
                   seenBusIds.add(h.bus.id);
               }
           });
           
           const departed = dayHistory.filter(h => h.action === 'manual_status_change' && h.details?.newStatus === 'departed');
           const delayed = dayHistory.filter(h => h.action === 'manual_status_change' && h.details?.newStatus === 'delayed');
           const announcements = dayHistory.filter(h => h.action === 'announcement_5min');
           
           document.getElementById('report-total').textContent = uniqueBuses.length;
           document.getElementById('report-departed').textContent = departed.length;
           document.getElementById('report-delayed').textContent = delayed.length;
           document.getElementById('report-announcements').textContent = announcements.length;
           
           const tbody = document.getElementById('report-table-body');
           tbody.innerHTML = uniqueBuses.map(h => `
               <tr>
                   <td>${h.bus.time}</td>
                   <td>${h.bus.route}</td>
                   <td><span class="status-badge status-${h.bus.status}">${getStatusText(h.bus.status)}</span></td>
                   <td>${h.bus.seats}</td>
               </tr>
           `).join('');
           
           document.getElementById('report-content').style.display = 'block';
       }

       function showHistory() {
           const selectedDate = document.getElementById('history-date').value;
           if (!selectedDate) {
               alert('–ö“Ø–Ω —Ç–∞–Ω–¥–∞“£—ã–∑! ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!');
               return;
           }
           
           const date = new Date(selectedDate);
           const dateStr = date.toDateString();
           const dayHistory = database.history.filter(h => 
               new Date(h.timestamp).toDateString() === dateStr
           );
           
           const tbody = document.getElementById('history-table-body');
           
           if (dayHistory.length === 0) {
               tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666;">–ë—É–ª –∫“Ø–Ω–¥”© —ç—á –∫–∞–Ω–¥–∞–π –∏—à-–∞—Ä–∞–∫–µ—Ç –±–æ–ª–≥–æ–Ω —ç–º–µ—Å</td></tr>';
               document.getElementById('history-content').style.display = 'block';
               return;
           }
           
           tbody.innerHTML = dayHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).map(h => `
               <tr>
                   <td>${new Date(h.timestamp).toLocaleTimeString('ru-RU')}</td>
                   <td>${getActionText(h.action)}</td>
                   <td>${h.bus.route}</td>
                   <td>${getDetailsText(h.action, h.details)}</td>
               </tr>
           `).join('');
           
           document.getElementById('history-content').style.display = 'block';
       }

       function getActionText(action) {
           const actions = {
               manual_add: '–ö–æ–ª –º–µ–Ω–µ–Ω –∫–æ—à—É–ª–¥—É',
               random_add: '–ö–æ–∫—É—Å—Ç—É–∫ –∫–æ—à—É–ª–¥—É',
               manual_status_change: '–°—Ç–∞—Ç—É—Å ”©–∑–≥”©—Ä—Ç“Ø–ª–¥“Ø',
               deleted: '”®—á“Ø—Ä“Ø–ª–¥“Ø',
               announcement_5min: '5 –º“Ø–Ω”©—Ç —ç—Å–∫–µ—Ä—Ç“Ø“Ø'
           };
           return actions[action] || action;
       }

       function getDetailsText(action, details) {
           if (!details) return '-';
           if (action === 'manual_status_change') {
               return `${getStatusText(details.oldStatus)} ‚Üí ${getStatusText(details.newStatus)}`;
           }
           return JSON.stringify(details);
       }

       function saveSettings() {
           alert('–ñ”©–Ω–¥”©”©–ª”©—Ä —Å–∞–∫—Ç–∞–ª–¥—ã! ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
       }

       function testSound() {
           alert('–î–æ–±—É—à —Ç–µ—Å—Ç–∏ –∏—à—Ç–µ–ª–¥–∏! ‚Ä¢ –¢–µ—Å—Ç –∑–≤—É–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
       }

       function resetSystem() {
           if (confirm('–°–∏—Å—Ç–µ–º–∞–Ω—ã –±–∞—à—Ç–∞–ø–∫—ã –∞–±–∞–ª–≥–∞ –∫–µ–ª—Ç–∏—Ä–µ—Å–∏–∑–±–∏? ‚Ä¢ –°–±—Ä–æ—Å–∏—Ç—å —Å–∏—Å—Ç–µ–º—É?')) {
               buses = [];
               database = { buses: [], deleted: [], history: [] };
               busCounter = 1;
               saveData();
               updateTable();
               updateStats();
               alert('–°–∏—Å—Ç–µ–º–∞ –±–∞—à—Ç–∞–ø–∫—ã –∞–±–∞–ª–≥–∞ –∫–µ–ª—Ç–∏—Ä–∏–ª–¥–∏! ‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞!');
           }
       }

       // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
       window.addEventListener('load', function() {
           loadData();
           setDefaultTime();
           console.log('‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∑–∞–ø—É—â–µ–Ω–∞');
       });

       // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
       setInterval(loadData, 5000);
   </script>
</body>
</html>